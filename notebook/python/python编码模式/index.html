<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Python编码模式 - 随笔</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Python\u7f16\u7801\u6a21\u5f0f";
    var mkdocs_page_input_path = "python\\python\u7f16\u7801\u6a21\u5f0f.md";
    var mkdocs_page_url = "/python/python\u7f16\u7801\u6a21\u5f0f/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> 随笔</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">主页</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../study/how2ask/">提问的智慧</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../python/">Python</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Python编码模式</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#python">Python 编码模式</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#_1">新建文件模板</a></li>
        
            <li><a class="toctree-l4" href="#readmemd">README.md</a></li>
        
            <li><a class="toctree-l4" href="#_2">重设系统编码</a></li>
        
            <li><a class="toctree-l4" href="#log">log设置与使用</a></li>
        
            <li><a class="toctree-l4" href="#config">config使用</a></li>
        
            <li><a class="toctree-l4" href="#_3">缓存的使用</a></li>
        
            <li><a class="toctree-l4" href="#_4">异常的使用</a></li>
        
            <li><a class="toctree-l4" href="#_5">异常和日志的组合</a></li>
        
            <li><a class="toctree-l4" href="#_6">语法杂项</a></li>
        
            <li><a class="toctree-l4" href="#docstring">docstring</a></li>
        
            <li><a class="toctree-l4" href="#doctest">doctest</a></li>
        
            <li><a class="toctree-l4" href="#pep8">样式：PEP8</a></li>
        
            <li><a class="toctree-l4" href="#import-thispython">import this：Python 之禅</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../pygame/">PyGame</a>
                </li>
                <li class="">
                    
    <a class="" href="../virtualenv/">Virtualenv</a>
                </li>
                <li class="">
                    
    <a class="" href="../matplotlib/">Matplotlib</a>
                </li>
                <li class="">
                    
    <a class="" href="../tensorflow/">Tensorflow</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tool</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../tool/atom/">Atom</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tool/sdkman/">Sdkman</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tool/graphviz_/">Graphviz</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Daily</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../daily/review2017/">review2017</a>
                </li>
                <li class="">
                    
    <a class="" href="../../daily/plan2018/">plan2018</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Book</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../book/how_to_read_a_book/">如何阅读一本书</a>
                </li>
                <li class="">
                    
    <a class="" href="../../book/%E6%96%AD%E8%88%8D%E7%A6%BB/">断舍离</a>
                </li>
                <li class="">
                    
    <a class="" href="../../book/%E7%AE%80%E7%BA%A6%E4%B9%8B%E7%BE%8E/">简约之美</a>
                </li>
                <li class="">
                    
    <a class="" href="../../book/%E6%9E%81%E7%AE%80%E4%B8%BB%E4%B9%89/">极简主义</a>
                </li>
                <li class="">
                    
    <a class="" href="../../book/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%B9%E6%B3%95/">解决问题最简单的方法</a>
                </li>
                <li class="">
                    
    <a class="" href="../../book/fupan/">复盘</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Fiction</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../novel/%E5%B0%8F%E8%AF%B4%E7%9A%84%E9%AA%A8%E6%9E%B6/">小说的骨架</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../about/">关于</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">随笔</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Python &raquo;</li>
        
      
    
    <li>Python编码模式</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="toc">
<ul>
<li><a href="#python">Python 编码模式</a><ul>
<li><a href="#_1">新建文件模板</a></li>
<li><a href="#readmemd">README.md</a></li>
<li><a href="#_2">重设系统编码</a></li>
<li><a href="#log">log设置与使用</a></li>
<li><a href="#config">config使用</a></li>
<li><a href="#_3">缓存的使用</a></li>
<li><a href="#_4">异常的使用</a></li>
<li><a href="#_5">异常和日志的组合</a></li>
<li><a href="#_6">语法杂项</a></li>
<li><a href="#docstring">docstring</a></li>
<li><a href="#doctest">doctest</a></li>
<li><a href="#pep8">样式：PEP8</a></li>
<li><a href="#import-thispython">import this：Python 之禅</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="python">Python 编码模式</h1>
<h2 id="_1">新建文件模板</h2>
<pre><code class="python">#!/usr/bin/env python
# -*- coding: utf-8 -*-
</code></pre>

<h2 id="readmemd">README.md</h2>
<p>简述系统内容，可以使用markdown语法自定义格式</p>
<h2 id="_2">重设系统编码</h2>
<pre><code class="python">import sys

try:
reload(sys)
    sys.setdefaultencoding('utf-8')
except NameError:
    # The only supported default encodings in Python are:

    #  Python 2.x: ASCII
    #  Python 3.x: UTF-8
    # So no need to sys.setdefaultencoding('utf-8')
    pass # py3
</code></pre>

<h2 id="log">log设置与使用</h2>
<ol>
<li>logging.conf 配置命令行和文件的日志读写</li>
</ol>
<pre><code class="python">[loggers]
keys=root,kol

[handlers]
keys=consoleHandler,fileHandler

[formatters]
keys=simpleFormatter

[logger_root]
level=DEBUG
handlers=consoleHandler

[logger_kol]
level=DEBUG
handlers=consoleHandler,fileHandler
qualname=kol
propagate=0

[handler_consoleHandler]
class=StreamHandler
level=DEBUG
formatter=simpleFormatter
args=(sys.stdout,)

[handler_fileHandler]  
class=logging.handlers.RotatingFileHandler  
level=DEBUG  
formatter=simpleFormatter  
args=('kol.log','a',20000,5,)

[formatter_simpleFormatter]
format=%(asctime)s - %(name)s - %(levelname)s - %(message)s
datefmt=
</code></pre>

<ol>
<li>__init__.py 初始化logger</li>
</ol>
<pre><code class="python">import logging.config

logging.config.fileConfig(&quot;logging.conf&quot;)
logger = logging.getLogger(\__name__)
logger.debug(&quot;started logging %s.&quot; % \__name__)
</code></pre>

<ol>
<li>.gitignore 在项目中排除log文件</li>
</ol>
<pre><code class="python"># project
*.log
</code></pre>

<h2 id="config">config使用</h2>
<pre><code class="python">import ConfigParser

config = ConfigParser.ConfigParser()
config.read(&quot;d:/influence.conf&quot;)
username = config.get(&quot;weibo&quot;, &quot;username&quot;)
password = config.get(&quot;weibo&quot;, &quot;password&quot;)
</code></pre>

<h2 id="_3">缓存的使用</h2>
<p>python3自带，python2下使用lru_cache_function</p>
<pre><code class="python">import lru

cookies = [000, 111, 222, 333, 444]


@lru.lru_cache_function(max_size=1024, expiration=15 * 60)
def f(account):
    print &quot;Calling f(&quot; + str(account) + &quot;)&quot;
    return cookies[account]

    print f(3)
    print f(0)
    print f(3)  # 15分钟内有效
</code></pre>

<h2 id="_4">异常的使用</h2>
<pre><code class="python">import traceback

try:
    raise IOError(&quot;io error!!!&quot;)  # 抛出第一个异常，被except捕获了    
except IOError, io_error:
    traceback.print_exc()   # 打印异常栈，第一个异常的栈
    print sys.exc_info()    # 打印异常信息
    print io_error          # 打印异常消息
    pass  # 异常处理完毕，系统正常继续
finally:
    print &quot;1 print always...&quot;

try:
    raise IOError(&quot;io error!!!&quot;)  # 抛出第一个异常，被except捕获了
except IOError, io_error:
    raise IOError(&quot;raise io error!!!&quot;)  # 抛出第二个异常，会被系统捕获，系统退出
finally:
    print &quot;2 print always...&quot;  # 但是还是会运行这里
</code></pre>

<p>注意：异常中不要使用裸露的except，except后跟具体的exceptions</p>
<h2 id="_5">异常和日志的组合</h2>
<p>python编译时能检查的问题相对较少
except 一定要打印 &amp; 出WARN/ERROR的log</p>
<h2 id="_6">语法杂项</h2>
<p>1.使用random choice随机选取seq一个值</p>
<pre><code class="python">import random

print random.choice((1, 2, 3))
print random.choice(['3', '4', 12L])
</code></pre>

<p>2.使用sum代替连加的reduce</p>
<p>新建文件test_sum.py,使用py.test测试验证结果</p>
<pre><code class="python">#!/usr/bin/env python
# -*- coding: utf-8 -*-


def test_sum():
assert sum([1, 2, 3], 0) == 6
assert reduce(lambda a, b: a + b, [1, 2, 3], 0) == 6
F:\gitlab\mola\house\learnpy&gt;py.test
============================= test session starts =============================
platform win32 -- Python 2.7.11, pytest-2.8.5, py-1.4.31, pluggy-0.3.1
rootdir: F:\gitlab\mola\house\learnpy, inifile:
collected 1 items

test_sum.py .

========================== 1 passed in 0.01 seconds ===========================
</code></pre>

<p>3.使用with处理文件连接（类似java7的自动关闭try）
4.json编码存文件（注意两段的区别）：</p>
<pre><code class="python">person = {&quot;name&quot;: &quot;哈哈哈&quot;}
with open(file_name, &quot;a&quot;) as f:
    f.write(json.dumps(person, ensure_ascii=False) + &quot;\n&quot;)

person = {&quot;name&quot;: u&quot;哈哈哈&quot;}
with codecs.open(file_name, &quot;a&quot;, &quot;utf-8&quot;) as f:
    f.write(json.dumps(person, ensure_ascii=False) + &quot;\n&quot;)
</code></pre>

<ol>
<li>使用<code>startswith()</code> and <code>endswith()</code>代替切片进行序列前缀或后缀的检查。比如：</li>
<li>Yes: <code>if foo.startswith('bar')</code>:优于</li>
<li>No: <code>if foo[:3] == 'bar'</code>:</li>
<li>使用isinstance()比较对象的类型。比如
Yes: <code>if isinstance(obj, int)</code>: 优于
No: <code>if type(obj) is type(1)</code>:</li>
<li>判断序列空或不空，有如下规则
Yes: <code>if not seq:</code>
<code>if seq:</code>
优于
No: <code>if len(seq)</code>
<code>if not len(seq)</code></li>
<li>二进制数据判断使用 <code>if boolvalue</code>的方式。</li>
</ol>
<h2 id="docstring">docstring</h2>
<p>模块/类/函数下的第一个字符串，作为文档存在
可使用<code>help()</code>或者<code>__doc__</code>访问
其间可以夹杂doctest作为简单的测试（较复杂的测试可以使用unittest或者功能强大但更简洁的<code>py.test</code>）</p>
<h2 id="doctest">doctest</h2>
<p>新建hello_doctest.py,使用doctest验证其作用：</p>
<pre><code class="python">#!/usr/bin/env python
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
This is the &quot;example&quot; module.

The example module supplies one function, factorial().  For example,

&gt;&gt;&gt; factorial(5)
120
&quot;&quot;&quot;


def factorial(n):
&quot;&quot;&quot;Return the factorial of n, an exact integer &gt;= 0.

    If the result is small enough to fit in an int, return an int.
    Else return a long.

    &gt;&gt;&gt; [factorial(n) for n in range(6)]
    [1, 1, 2, 6, 24, 120]
    &gt;&gt;&gt; [factorial(long(n)) for n in range(6)]
    [1, 1, 2, 6, 24, 120]
    &gt;&gt;&gt; factorial(30)
    265252859812191058636308480000000L
    &gt;&gt;&gt; factorial(30L)
    265252859812191058636308480000000L
    &gt;&gt;&gt; factorial(-1)
    Traceback (most recent call last):
        ...
    ValueError: n must be &gt;= 0

    Factorials of floats are OK, but the float must be an exact integer:
    &gt;&gt;&gt; factorial(30.1)
    Traceback (most recent call last):
        ...
    ValueError: n must be exact integer
    &gt;&gt;&gt; factorial(30.0)
    265252859812191058636308480000000L

    It must also not be ridiculously large:
    &gt;&gt;&gt; factorial(1e100)
    Traceback (most recent call last):
        ...
    OverflowError: n too large
    &quot;&quot;&quot;

import math
if not n &gt;= 0:
raise ValueError(&quot;n must be &gt;= 0&quot;)
if math.floor(n) != n:
raise ValueError(&quot;n must be exact integer&quot;)
if n + 1 == n:  # catch a value like 1e300
raise OverflowError(&quot;n too large&quot;)
    result = 1
factor = 2
while factor &lt;= n:
        result *= factor
        factor += 1
return result


if __name__ == &quot;__main__&quot;:
import doctest
    doctest.testmod()

</code></pre>

<p>F:\gitlab\mola\house\learnpy&gt;python hello_doctest.py -v</p>
<pre><code class="python">Trying:
    factorial(5)
Expecting:
    120
ok
Trying:
    [factorial(n) for n in range(6)]
Expecting:
    [1, 1, 2, 6, 24, 120]
ok
Trying:
    [factorial(long(n)) for n in range(6)]
Expecting:
    [1, 1, 2, 6, 24, 120]
ok
Trying:
    factorial(30)
Expecting:
    265252859812191058636308480000000L
ok
Trying:
    factorial(30L)
Expecting:
    265252859812191058636308480000000L
ok
Trying:
    factorial(-1)
Expecting:
    Traceback (most recent call last):
        ...
    ValueError: n must be &gt;= 0
ok
Trying:
    factorial(30.1)
Expecting:
    Traceback (most recent call last):
        ...
    ValueError: n must be exact integer
ok
Trying:
    factorial(30.0)
Expecting:
    265252859812191058636308480000000L
ok
Trying:
    factorial(1e100)
Expecting:
    Traceback (most recent call last):
        ...
    OverflowError: n too large
ok
2 items passed all tests:
   1 tests in __main__
   8 tests in __main__.factorial
9 tests in 2 items.
9 passed and 0 failed.
Test passed.
</code></pre>

<p>注意：在测试通过的情况下，默认不打印详情。加上-v参数可以查看测试的详情。</p>
<h2 id="pep8">样式：PEP8</h2>
<p>PEP8全文见：https://www.python.org/dev/peps/pep-0008/</p>
<p>自动检测: <a href="https://github.com/hhatto/autopep8">autopep8</a></p>
<p>安装：<code>pip install autopep8</code></p>
<p>关键点如下:
1. 模块内容的顺序
模块说明和docstring—import—globals&amp;constants—其他定义。其中import部分，又按标准、三方和自己编写顺序依次排放，之间空一行。</p>
<ol>
<li>
<p>不要在一句import中多个库，比如import os, sys不推荐。</p>
</li>
<li>
<p>如果采用from XX import XX引用库，可以省略‘module.’，都是可能出现命名冲突，这时就要采用import XX。</p>
</li>
<li>
<p>模块命名尽量短小，使用全部小写的方式，可以使用下划线。</p>
</li>
<li>
<p>包命名尽量短小，使用全部小写的方式，不可以使用下划线。</p>
</li>
<li>
<p>类的命名使用CapWords的方式，模块内部使用的类采用_CapWords的方式。</p>
</li>
<li>
<p>异常命名使用CapWords+Error后缀的方式。</p>
</li>
<li>
<p>函数命名使用全部小写的方式，可以使用下划线。</p>
</li>
<li>
<p>常量命名使用全部大写的方式，可以使用下划线。</p>
</li>
<li>
<p>类的属性（方法和变量）命名使用全部小写的方式，可以使用下划线。
类的属性有3种作用域public、non-public和subclass API，可以理解成C++中的public、private、protected，non-public属性前，前缀一条下划线。
类的属性若与关键字名字冲突，后缀一下划线，尽量不要使用缩略等其他方式。</p>
</li>
</ol>
<p>11.其他：
- 有语义分隔的加空行
- 标点符号后加空格
- 长行加<code>\</code>分行，运算符置于下行头部</p>
<h2 id="import-thispython">import this：Python 之禅</h2>
<ul>
<li>
<p>Beautiful is better than ugly.
 优美胜于丑陋。</p>
</li>
<li>
<p>Explicit is better than implicit.
 显式胜于隐式。</p>
</li>
<li>
<p>Simple is better than complex.
  简单胜于复杂。</p>
</li>
<li>
<p>Complex is better than complicated.
  复杂胜于难懂。</p>
</li>
<li>
<p>Flat is better than nested.
  扁平胜于嵌套。</p>
</li>
<li>
<p>Sparse is better than dense.
  分散胜于密集。</p>
</li>
<li>
<p>Readability counts.
  可读性应当被重视。</p>
</li>
<li>
<p>Special cases aren’t special enough to break the rules. Although practicality beats purity.
  尽管实用性会打败纯粹性，特例也不能凌驾于规则之上。</p>
</li>
<li>
<p>Errors should never pass silently. Unless explicitly silenced.
除非明确地使其沉默，错误永远不应该默默地溜走。</p>
</li>
<li>
<p>In the face of ambiguity, refuse the temptation to guess.
面对不明确的定义，拒绝猜测的诱惑。</p>
</li>
<li>
<p>There should be one– and preferably only one –obvious way to do it.
用一种方法，最好只有一种方法来做一件事。</p>
</li>
<li>
<p>Although that way way not be obvious at first unless you’re Dutch.
虽然一开始这种方法并不是显而易见的，但谁叫你不是Python之父呢。</p>
</li>
<li>
<p>Now is better than never. Although never is often better than right now.
做比不做好，但立马去做有时还不如不做。</p>
</li>
<li>
<p>If the implementation is hard to explain, it’s a bad idea.
如果实现很难说明，那它是个坏想法。</p>
</li>
<li>
<p>If the implementation is easy to explain, it may be a good idea.
如果实现容易解释，那它有可能是个好想法。</p>
</li>
<li>
<p>Namespaces are one honking great idea – let’s do more of those!
命名空间是个绝妙的想法，让我们多多地使用它们吧！</p>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pygame/" class="btn btn-neutral float-right" title="PyGame">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../python/" class="btn btn-neutral" title="Python"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../python/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../pygame/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
